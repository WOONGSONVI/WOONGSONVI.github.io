---
layout: single
title: "[Modeling] Stacking & Blending Ensemble"
categories: [AI]
tag: [Machine Learning, Deep Learning, Modeling]
toc: true
use_math: true
author_profile: false
typora-root-url: ../
---
-----
ì•ˆë…•í•˜ì„¸ìš”. ìê²©ì¦ ì¤€ë¹„ì™€ ê³µëª¨ì „ ì°¸ì—¬ë¡œ ê·¸ ë™ì•ˆ ë¸”ë¡œê·¸ í™œë™ì„ ë„ˆë¬´ ëª»í–ˆë„¤ìš”. ê·¸ë˜ì„œ ì˜¤ëœë§Œì— í¬ìŠ¤íŒ…í•˜ë ¤ê³  í•©ë‹ˆë‹¤! ğŸ˜ ì˜¤ëŠ˜ ì „ë‹¬í•´ë“œë¦´ ë‚´ìš©ì€ AI ê³µëª¨ì „ì—ì„œ ë§ì´ ì‚¬ìš©ë˜ëŠ” ê¸°ë²• ì¤‘ í•˜ë‚˜ì¸ Stacking & Blending Ensembleì— ëŒ€í•´ ì„¤ëª…ë“œë¦¬ë ¤ í•©ë‹ˆë‹¤. ê³µëª¨ì „ì—ì„œ ìƒìœ„ê¶Œì— ë­í¬ë˜ì–´ ìˆëŠ” ëŒ€ë¶€ë¶„ì˜ ì‚¬ëŒë“¤ì´ ì •í™•ë„ë¥¼ ê·¹í•œìœ¼ë¡œ ëŒì–´ì˜¬ë¦¬ê¸° ìœ„í•´ ì´ ê¸°ë²•ë“¤ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì–¸ëœ» ë³´ë©´ ë‘ ê¸°ë²•ì€ ë¹„ìŠ·í•´ ë³´ì´ì§€ë§Œ ë‹¤ë¥¸ ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì–´ë–»ê²Œ ë‹¤ë¥¸ì§€ ê°™ì´ í™•ì¸í•´ ë³´ì‹œì£ ~!

## ê°œìš”

ìš°ì„  Ensemble ê¸°ë²•ì´ ë¬´ì—‡ì¸ì§€ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤. <u><b>Ensemble</b></u>ì´ë€ <mark style='background-color: #7ff5a0'>ë‹¤ì–‘í•œ ML, DL ê¸°ë²•ë“¤ì„ ê²°í•©í•˜ì—¬ ì˜ˆì¸¡ì„±ëŠ¥ì„ ë†’ì´ëŠ” í•™ìŠµ</mark>ì„ ë§í•©ë‹ˆë‹¤. ë°ì´í„° ë¶„ì„ì„ í•˜ê²Œ ë˜ë©´ ì €ë§ˆë‹¤ì˜ ëª¨ë¸ë§ë§ˆë‹¤ ì•Œê³ ë¦¬ì¦˜, ì˜ˆì¸¡ ê²°ê³¼, ì„±ëŠ¥ì´ ë‹¤ ë‹¤ë¦…ë‹ˆë‹¤. í•˜ë‚˜ì˜ ëª¨ë¸ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¨ ë§ì€ ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ê²°í•©í•˜ëŠ” ê²ƒì´ í›¨ì”¬ ì„±ëŠ¥ì´ ì¢‹ì€ ëª¨ë¸ì„ ë§Œë“¤ ê²ƒì…ë‹ˆë‹¤. ì´ì— Ensemble ê¸°ë²•ì€ ë°ì´í„° ë¶„ì„ì˜ ê½ƒì´ë¼ê³  ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Stacking Ensemble

<u><b>Stacking Ensemble</b></u>ì€ <mark style='background-color: #7ff5a0'>ê°ê°ì˜ ë‹¤ì–‘í•œ ëª¨ë¸ì„ í†µí•´ ì¶”ì¶œëœ ì˜ˆì¸¡ê°’ë“¤ì„ ë‹¤ì‹œ Train Dataì™€ Test Dataë¡œ ê²°í•©í•˜ì—¬ ëª¨ë¸ë§ í•¨ìœ¼ë¡œì¨ ìµœì¢… ì˜ˆì¸¡ì„ ë” ë‚˜ì€ ì„±ëŠ¥ìœ¼ë¡œ ë§Œë“œëŠ” ê°•ë ¥í•œ Ensemble ê¸°ë²•</mark> ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ì¦‰, <mark style='background-color: #f39393'>ì„œë¡œ ë‹¤ë¥¸ ëª¨ë¸ë§ì„ í†µí•´ ê°ê°ì˜ ì˜ˆì¸¡ê°’ì„ ì¶”ì¶œí•˜ëŠ” $Stage~1$</mark>ê³¼ <mark style='background-color: #f39393'>ì´ëŸ¬í•œ ì˜ˆì¸¡ê°’ë“¤ì„ ëª¨ì•„ ë‹¤ì‹œ í•˜ë‚˜ì˜ Datasetìœ¼ë¡œ ë§Œë“¤ì–´ ëª¨ë¸ë§ì„ í•˜ëŠ” $Stage~2$</mark>ë¡œ ì§„í–‰í•˜ê²Œ ë©ë‹ˆë‹¤. ìì„¸í•œ ì•Œê³ ë¦¬ì¦˜ í”„ë¡œì„¸ìŠ¤ëŠ” ê¸€ë¡œë§Œ ì“°ê¸°ì—ëŠ” ê½¤ ë³µì¡í•˜ê¸° ë•Œë¬¸ì— ê°„ë‹¨í•œ ì˜ˆì‹œë¥¼ í†µí•´ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤!

ì•„ë˜ì™€ ê°™ì´ Train Dataì™€ Test Dataê°€ ìˆìŠµë‹ˆë‹¤. ShapeëŠ” ë‹¤ìŒê³¼ ê°™ì„ ê²ƒì…ë‹ˆë‹¤.

<img src="/images/2024-04-14-AI3/image-20240414150115962.png" alt="image-20240414150115962" style="zoom:80%;" />{: .align-center}

- X_train.shape : $(6, 3)$
- y_train.shape : $(6, )$
- X_test.shape : $(3, 3)$
- y_test.shape : $(3, )$

í¸ì˜ìƒ $Y$ê°€ $0$ ë˜ëŠ” $1$ì¸ ì´ì§„ë¶„ë¥˜ ëª¨ë¸ë§ìœ¼ë¡œ ê°€ì •í•˜ê² ìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ì €ëŠ” Modelì„ í•˜ë‚˜ë§Œ ì“°ì§€ ì•Šê³ , Model1 ~ Model4 ê¹Œì§€ì˜ 4ê°œì˜ ëª¨ë¸ì„ ì‚¬ìš©í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤. ë¨¼ì € Model 1ì„ ì‚¬ìš©í•˜ì—¬ ì•„ë˜ì™€ ê°™ì´ Train_pred1ê³¼ Test_pred1ì„ ë„ì¶œí–ˆìŠµë‹ˆë‹¤.

<img src="/images/2024-04-14-AI3/image-20240414150346245.png" alt="image-20240414150346245" style="zoom:80%;" />{: .align-center}

ê°™ì€ ë°©ë²•ìœ¼ë¡œ Model2~4ê¹Œì§€ ëª¨ë¸ë§ì„ í•˜ê²Œ ë˜ë©´ Train_pred2~4ì™€ Test_pred2~4ê°€ ìƒì„±ë  ê²ƒì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ Stackingì„ ì‹œë„í•©ë‹ˆë‹¤.

Train Dataë¥¼ Model1~4ì— ë„£ì–´ ì¶”ì¶œëœ Train_pred1~4 ê°’ë“¤ì„ ìƒˆë¡œìš´ Train Data Setìœ¼ë¡œ ê²°í•©í•˜ê³ , Test Dataë¥¼ Model1~4ì— ë„£ì–´ ì¶”ì¶œëœ Test_pred1~4 ê°’ë“¤ì„ ìƒˆë¡œìš´ Test Data Setìœ¼ë¡œ ê²°í•©í•©ë‹ˆë‹¤. (í¸ì˜ìƒ ê°ê° Stacking Train Data, Stacking Test Dataë¼ê³  ë¶€ë¥´ê² ìŠµë‹ˆë‹¤.)

ê·¸ë¦¬ê³  Stackingí•œ ë°ì´í„°ë“¤ì„ ì›í•˜ëŠ” Modelë¡œ í•™ìŠµì„ í•˜ë©´ ìµœì¢… ì˜ˆì¸¡ê°’ì´ ì¶”ì¶œë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

<img src="/images/2024-04-14-AI3/image-20240414150823819.png" alt="image-20240414150823819" style="zoom:80%;" />{: .align-center}

ì¼ë°˜ì ì¸ Stacking Ensemble ì•Œê³ ë¦¬ì¦˜ì€ ì´ì™€ ê°™ìœ¼ë‚˜, ëŒ€ë¶€ë¶„ ì‚¬ëŒë“¤ì€ ì´ ë°©ì‹ì˜ Stacking Ensembleì€ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ Train Dataì— ê³¼ëŒ€ì í•©ëœ ëª¨ë¸ì´ ë‚˜ì˜¬ ê°€ëŠ¥ì„±ì´ ë§¤ìš° í¬ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ CV ê¸°ë°˜ì˜ Stacking Ensembleì´ ë‚˜ì˜¤ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. (ì €ë„ CVë¥¼ ì‚¬ìš©í•˜ëŠ” ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ë§ì´ í™œìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤!)



### CV ê¸°ë°˜ì˜ Stacking Ensemble

CVë€ Cross Validationì„ ë§í•©ë‹ˆë‹¤. ì¦‰, <mark style='background-color: #7ff5a0'>KFold êµì°¨ê²€ì¦ì„ í†µí•´ Train Dataë¥¼ ë‚˜ëˆ„ê³ , ê° Foldë§ˆë‹¤ ì¶”ì¶œëœ Train_predì™€ Test_predë¥¼ í†µí•´ Stackingí•˜ëŠ” ê¸°ë²•</mark>ì…ë‹ˆë‹¤. ì—­ì‹œ ë§ë³´ë‹¤ëŠ” ì˜ˆì‹œê°€ ë” ì´í•´í•˜ê¸° ì‰½ê² ì£ ?!! 

ì•„ë˜ ì˜ˆì‹œë¥¼ ë³´ë©´ Train Dataê°€ 3 Foldë¡œ ë‚˜ë‰˜ì–´ì ¸ ìˆìŠµë‹ˆë‹¤. ì´ ìƒíƒœì—ì„œ Fold 1~2ë¥¼ Model 1ì— ëŒ€í•´ ëª¨ë¸ë§ í•™ìŠµí•˜ì—¬ Fold 3ë¥¼ ì˜ˆì¸¡í•´ë³´ê² ìŠµë‹ˆë‹¤. ì˜ˆì¸¡í•œ ê°’ì€ Train_pred1ì— ë„£ìŠµë‹ˆë‹¤. ì¦‰, Fold 3ì— í•´ë‹¹ë˜ëŠ” ë¶€ë¶„ë§Œ Train_pred1ì— ì±„ì›Œì§ˆ ê²ƒì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  í•™ìŠµí•œ ëª¨ë¸ì— Test Dataë¥¼ ì…ë ¥í•˜ì—¬ ì˜ˆì¸¡í•œ ê°’ì„ pred1_1ë¡œ ë‘ê² ìŠµë‹ˆë‹¤.

ë§ˆì°¬ê°€ì§€ë¡œ Fold 1, Fold 3ë¥¼ Model 1ì— ë„£ì–´ í•™ìŠµí•˜ê³ , í•™ìŠµí•œ ëª¨ë¸ì— Fold 2ë¥¼ ì…ë ¥ê°’ìœ¼ë¡œ ë„£ìœ¼ë©´ Train_pred2 ì˜ˆì¸¡ê°’ì´ ë‚˜ì˜¬ ê²ƒì´ë©°, í•™ìŠµí•œ ëª¨ë¸ì— Test Dataë¥¼ ì…ë ¥í•˜ë©´ pred1_2ê°€ ë‚˜ì˜¬ ê²ƒì…ë‹ˆë‹¤.

<img src="/images/2024-04-14-AI3/image-20240414153049714.png" alt="image-20240414153049714" style="zoom:80%;" />{: .align-center}

ì´ë ‡ê²Œ ëª¨ë“  Train Dataì˜ Foldì— ëŒ€í•´ Model 1ì„ ê°ê° í•™ìŠµì‹œí‚¤ë©´, ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜µë‹ˆë‹¤. ê·¸ëŸ°ë° ì—¬ê¸°ì„œ ì¼ë°˜ Stacking Ensembleê³¼ ë‹¤ë¥¸ ì ì´ ë°œìƒí•©ë‹ˆë‹¤. Train_pred1ì€ í•˜ë‚˜ì˜ ê°’ìœ¼ë¡œ ì˜ ë‚˜ì™”ì§€ë§Œ, Test Dataì˜ ì˜ˆì¸¡ê°’ì€ 1ê°œê°€ ì•„ë‹Œ Foldì˜ ìˆ˜ì¸ pred1_1 ~ pred1_3ì˜ 3ê°œê°€ ë‚˜ì˜¤ê²Œ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ, ì¼ë°˜ì ìœ¼ë¡œëŠ” í‰ê· ì´ë‚˜ ìµœë¹ˆê°’ì„ ì´ìš©í•˜ì—¬ í•˜ë‚˜ì˜ Test_pred1 ê°’ìœ¼ë¡œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤. ë§Œì•½ í‰ê· ì„ ì´ìš©í•œë‹¤ë©´, ì•„ë˜ Test Data ê° í–‰ì˜ ì˜ˆì¸¡ê°’ì€ (1, 0.3, 0.6)ì´ ë  ê²ƒì´ê³ , 0ê³¼ 1ì˜ ê¸°ì¤€ì¹˜ì¸ Thresholdë¥¼ 0.5ë¡œ ì¡ëŠ”ë‹¤ë©´ Test_pred1ì€ (1, 0, 1)ì´ ë˜ëŠ” ê²ƒì´ì£ !

<img src="/images/2024-04-14-AI3/image-20240414153845059.png" alt="image-20240414153845059" style="zoom:80%;" />{: .align-center}

ìœ„ê¹Œì§€ì˜ ê³¼ì •ì€ Model 1ì— ëŒ€í•œ ë‚´ìš©ì…ë‹ˆë‹¤. ì´ë¥¼ Model 2~4ê¹Œì§€ í•´ì£¼ë©´ ì•„ê¹Œì™€ ê°™ì´ Train_pred1~4ì™€ Test_pred1~4ê°€ ë§Œë“¤ì–´ì§€ê³  Stage 1ì€ ëë‚˜ê²Œ ë©ë‹ˆë‹¤. Stage 2ë„ KFold êµì°¨ê²€ì¦ì„ ì´ìš©í•œë‹¤ëŠ” ê²ƒì„ ì œì™¸í•˜ê³ ëŠ” ì¼ë°˜ Stacking Ensembleê³¼ ë™ì¼í•˜ê²Œ ì˜ˆì¸¡í•˜ë©´ ë©ë‹ˆë‹¤. 

<img src="/images/2024-04-14-AI3/image-20240414154330414.png" alt="image-20240414154330414" style="zoom:80%;" />{: .align-center}

ì§€ê¸ˆê¹Œì§€ì˜ ì˜ˆì‹œëŠ” ì´ì§„ë¶„ë¥˜ë¥¼ ëª©ì ìœ¼ë¡œ ë‘” CV ê¸°ë°˜ì˜ Stacking Ensembleì…ë‹ˆë‹¤. ë§Œì•½, ë‹¤ì¤‘ ë¶„ë¥˜ì¼ ê²½ìš°ì—ëŠ” ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”? ë‹¤ì–‘í•œ ë°©ë²•ì´ ìˆê² ì§€ë§Œ, ì €ë¼ë©´ Stage 1ì—ì„œ predict ê°’ì´ ì•„ë‹Œ predict_proba ê°’ì„ Train_predì™€ Test_predë¡œ ê°€ì ¸ê°ˆ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì‚¼ì§„ë¶„ë¥˜ì˜ ê²½ìš°, ê° Modelë§ˆë‹¤ (?, 3)ì˜ Train_predict_proba, Test_predict_probaë¥¼ ê°€ì ¸ê°ˆ ê²ƒì…ë‹ˆë‹¤. ì¦‰, ë˜‘ê°™ì´ Model 1~4ë¥¼ ì‚¬ìš©í•œë‹¤ê³  í•  ë•Œ, Stage 2ì—ì„œ Stacking Train Dataì™€ Stacking Test Dataì˜ Column ìˆ˜ëŠ” ê°ê° 13ê°œê°€ ë  ê²ƒì…ë‹ˆë‹¤. (X ë³€ìˆ˜ 12ê°œ(4(ëª¨ë¸ ìˆ˜) $\times$ 3(Y ë²”ì£¼ ìˆ˜) = 12) + Y ë³€ìˆ˜ 1ê°œ)

ë‹¤ì¤‘ ë¶„ë¥˜ì—ì„œ predict_proba ê°’ì´ ì•„ë‹Œ predict ê°’ì„ ì´ìš©í•´ë„ ìƒê´€ì€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ê·¸ëŒ€ë¡œ ê°€ì ¸ê°€ë©´ ë²”ì£¼í˜• ê°’ì— ëŒ€í•´ í‰ê· ì„ ì·¨í•´ì•¼ í•˜ë‹ˆ ë¬¸ì œê°€ ë  ê²ƒì´ë¯€ë¡œ, OneHotEncoder í˜•ì‹ê³¼ ê°™ì´ ë³€í™˜ì´ í•„ìš”í•©ë‹ˆë‹¤. ê²°êµ­, ì‚¼ì§„ë¶„ë¥˜ì—ì„œ predict ê°’ì„ ê°€ì ¸ê°€ë„ Stacking Train Dataì™€ Stacking Test Dataì˜ Column ìˆ˜ëŠ” ë˜‘ê°™ì´ 13ê°œê°€ ë©ë‹ˆë‹¤.

<img src="/images/2024-04-14-AI3/image-20240414160607561.png" alt="image-20240414160607561" style="zoom:80%;" />{: .align-center}

Y ê°’ì´ ì—°ì†í˜•ì¸ ê²½ìš°ëŠ” ì´ëŸ¬í•œ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šìœ¼ë¯€ë¡œ í•˜ë‚˜ì˜ ì—´ë¡œ ê°€ì ¸ê°€ë©´ ë©ë‹ˆë‹¤! ì¦‰, Model 1~4ë¥¼ ì‚¬ìš©í•œë‹¤ê³  í–ˆì„ ë•Œ, Stacking Train Dataì™€ Stacking Test Dataì˜ Column ìˆ˜ëŠ” 5ê°œê°€ ë©ë‹ˆë‹¤. (X ë³€ìˆ˜ 4ê°œ(ëª¨ë¸ ìˆ˜ : 4ê°œ) + Y ë³€ìˆ˜ 1ê°œ)



## Blending Ensemble

<u><b>Blending Ensemble</b></u>ì€ <mark style='background-color: #7ff5a0'>KFold êµì°¨ê²€ì¦ì„ í•˜ì§€ ì•Šê³ , ë°ì´í„°ë¥¼ PartTrain-Validation-Testë¡œ ë‚˜ëˆˆ ìƒíƒœì—ì„œ ê° ëª¨ë¸ì— ëŒ€í•œ Validationì˜ ì˜ˆì¸¡ê°’ë“¤ì„ Validation Data Setì— ì¶”ê°€í•˜ì—¬ Test Dataë¥¼ ì˜ˆì¸¡í•˜ëŠ” ë°©ë²•</mark>ì…ë‹ˆë‹¤. ìœ„ì˜ ë¬¸êµ¬ì—ì„œ PartTrainê³¼ Validationì„ í•©ì¹œ ê²ƒì´ Train Dataì…ë‹ˆë‹¤. Stacking Ensembleê³¼ í¬ê²Œ ë‹¤ë¥¸ ì ì€ ì„¸ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

- Stacking Ensembleì€ <mark style='background-color: #f39393'>Train Dataì˜ ì˜ˆì¸¡ê°’</mark>ì„ Stage 2ì— ì‚¬ìš©í•˜ì§€ë§Œ, Blending Ensembleì€ <mark style='background-color: #f39393'>Validation Dataì˜ ì˜ˆì¸¡ê°’</mark>ì„ Stage 2ì— ì‚¬ìš©í•©ë‹ˆë‹¤.
- Stacking Ensembleì€ Stage 2ì—ì„œ <mark style='background-color: #f39393'>ì˜ˆì¸¡ê°’ë§Œ</mark>ì„ ì´ìš©í•˜ì§€ë§Œ, Blending Ensembleì€<mark style='background-color: #f39393'> Validation Dataì˜ ê¸°ì¡´ ë³€ìˆ˜ë“¤</mark>ë„ í•¨ê»˜ ì´ìš©í•©ë‹ˆë‹¤.
- Stacking Ensembleì€ <mark style='background-color: #f39393'>CV ê¸°ë°˜ì˜ êµì°¨ê²€ì¦ì„ ì´ìš©</mark>í•˜ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ, Blending Ensembleì€ <mark style='background-color: #f39393'>êµì°¨ê²€ì¦ì„ ì§„í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</mark>

Blending Ensembleë„ ë‘ ë‹¨ê³„ì— ê±°ì³ì„œ ì§„í–‰ë©ë‹ˆë‹¤. <mark style='background-color: #f39393'>Stage 1ì—ì„œëŠ” ì„œë¡œ ë‹¤ë¥¸ ëª¨ë¸ë§ì„ í†µí•´ Validation Dataì™€ Test Dataì˜ ì˜ˆì¸¡ê°’ì„ ì¶”ì¶œ</mark>í•˜ê³  <mark style='background-color: #f39393'>Stage 2ì—ì„œëŠ” ì˜ˆì¸¡ê°’ë“¤ì„ ê°ê° ê¸°ì¡´ ë°ì´í„°ì— ë³€ìˆ˜ë¡œì„œ ì¶”ê°€í•˜ì—¬ Datasetìœ¼ë¡œ ë§Œë“¤ê³  ëª¨ë¸ë§</mark>ì„ í•©ë‹ˆë‹¤.

Blending Ensembleì€ Stacking Ensembleë³´ë‹¤ ì•Œê³ ë¦¬ì¦˜ì´ ê°„ë‹¨í•˜ì—¬ ì‹œê°„ì ˆì•½ì— í° ì¥ì ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ë‹¨ì ì€ Stacking Ensembleë³´ë‹¤ ì‚¬ìš©í•˜ëŠ” ë°ì´í„° ìˆ˜ê°€ ì ì–´ì§€ê³ , êµì°¨ê²€ì¦ì„ ì§„í–‰í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— Validation Dataì— ê³¼ëŒ€ì í•©ì´ ë  ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤. ì—­ì‹œ ì˜ˆì‹œë¥¼ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ì•„ë˜ì™€ ê°™ì´ Train Dataì™€ Test Dataê°€ ìˆê³ , Train DataëŠ” PartTrain Dataì™€ Validation Dataë¡œ ë‚˜ë‰  ê²ƒì…ë‹ˆë‹¤. ê°ê°ì˜ ShapeëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

<img src="/images/2024-04-14-AI3/image-20240414162334322.png" alt="image-20240414162334322" style="zoom:80%;" />{: .align-center}

- X_train.shape : $(6, 3)$
- y_train.shape : $(6, )$
- X_partrain.shape : $(3, 3)$
- y_partrain.shape : $(3, )$
- X_val.shape : $(3, 3)$
- y_val.shape : $(3, )$
- X_test.shape : $(3, 3)$
- y_test.shape : $(3, )$

ì•Œê³ ë¦¬ì¦˜ì€ ê°„ë‹¨í•©ë‹ˆë‹¤. PartTrain Dataë¡œ Model 1ì„ í•™ìŠµí•˜ê³  Validation Dataì™€ Test Dataë¥¼ ì˜ˆì¸¡í•©ë‹ˆë‹¤. ì˜ˆì¸¡ê°’ì€ ê°ê° Val_pred1ê³¼ Test_pred1ì´ ë„ì¶œë©ë‹ˆë‹¤.

<img src="/images/2024-04-14-AI3/image-20240414162932769.png" alt="image-20240414162932769" style="zoom:80%;" />{: .align-center}

ìœ„ì˜ ê³¼ì •ì„ Model 2~4ê¹Œì§€ ì§„í–‰í•˜ë©´ Val_pred2~4ì™€ Test_pred2~4ê°€ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤. Stage 2ì—ì„œëŠ” Val_pred1~4ì™€ Test_pred1~4ë¥¼ ê°ê° Validation Dataì™€ Test Dataì— ë¶™ì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì›í•˜ëŠ” Modelë¡œ í•™ìŠµì„ í•˜ë©´ ìµœì¢… ì˜ˆì¸¡ê°’ì´ ì¶”ì¶œë©ë‹ˆë‹¤.

<img src="/images/2024-04-14-AI3/image-20240414163144845.png" alt="image-20240414163144845" style="zoom:80%;" />{: .align-center}



## ì‹¤ìŠµ

ì´ì œ ì‹¤ì œ ë°ì´í„°ë¥¼ ì´ìš©í•˜ì—¬ ì‹¤ìŠµí•´ë³´ì£ ! ë°ì´í„°ëŠ” Seabornì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ”, ì–´ë–»ê²Œ ë³´ë©´ êµ­ë¯¼ ë°ì´í„° ì¤‘ í•˜ë‚˜ì¸ íƒ€ì´íƒ€ë‹‰ ë°ì´í„°ë¥¼ í™œìš©í•´ë³´ê² ìŠµë‹ˆë‹¤. ğŸ˜ ê°„ë‹¨íˆ ì „ì²˜ë¦¬í•˜ì—¬ ë°ì´í„°ë¥¼ ì•„ë˜ì™€ ê°™ì´ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.

- ë°ì´í„° íŠ¹ì§•

  - Titanic Data : $(712, 11)$


```python
titanic = sns.load_dataset('titanic')
Rdata = titanic.copy()
Rdata2 = Rdata.drop(['deck', 'who', 'adult_male', 'alive'], axis = 1)
Rdata3 = Rdata2.dropna(axis = 0)
Rdata3.reset_index(drop = True, inplace = True)
```

```python
temp_columns1 = Rdata3.select_dtypes(include = 'object').columns
temp_columns2 = Rdata3.select_dtypes(include = 'bool').columns
temp_columns3 = Rdata3.select_dtypes(include = 'category').columns

le1 = LabelEncoder()

for i in temp_columns1 :
  Rdata3[i] = le1.fit_transform(Rdata3[i])

for i in temp_columns2 :
  Rdata3[i] = le1.fit_transform(Rdata3[i])

for i in temp_columns3 :
  Rdata3[i] = le1.fit_transform(Rdata3[i])

Rdata3
```

<img src="/images/2024-04-14-AI3/image-20240414163815824.png" alt="image-20240414163815824" style="zoom:80%;" />

```python
X = Rdata3.drop(['survived'], axis = 1)
y = Rdata3['survived']

print(X.shape)
print(y.shape)
--------------------------------------------------------------------------------------------------------------------------------
(712, 10)
(712,)
```

```python
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.3, random_state = 39, stratify = y)
X_train.reset_index(inplace = True, drop = True)
y_train.reset_index(inplace = True, drop = True)

print(X_train.shape)
print(X_test.shape)
print(y_train.shape)
print(y_test.shape)
--------------------------------------------------------------------------------------------------------------------------------
(498, 10)
(214, 10)
(498,)
(214,)
```

<br>

### (1) ì¼ë°˜ ë‹¨ì¼ ëª¨ë¸

ì •í™•í•œ ë¹„êµë¥¼ ìœ„í•´ ë‹¨ì¼ ëª¨ë¸ë¡œ ë¨¼ì € ì„±ëŠ¥ì„ ë¹„êµí•´ë´…ì‹œë‹¤. ì œê°€ ì‚¬ìš©í•˜ê³  ì‹¶ì€ ëª¨ë¸ì€ ì´ 5ê°œë¡œ, LightGBM, XgBoost, CatBoost, ExtraTrees, RandomForestì…ë‹ˆë‹¤. ì›ë˜ëŠ” ì´ˆëª¨ìˆ˜ë„ Optunaë¥¼ í†µí•´ ìµœì ì˜ Parameterë¥¼ êµ¬í•´ì•¼ í•˜ë‚˜ ì‹œê°„ìƒ ìƒëµí•˜ê³  í•™ìŠµí–ˆìŠµë‹ˆë‹¤. ê° ëª¨ë¸ì— ëŒ€í•œ Accuracy ScoreëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```python
# 1-1. ë‹¨ì¼ ëª¨ë¸ lightgbm

lgb_model1 = LGBMClassifier(random_state = 39)
lgb_model1.fit(X_train, y_train)

lgb_train_pred1 = lgb_model1.predict(X_train)
lgb_test_pred1 = lgb_model1.predict(X_test)

print(accuracy_score(y_train, lgb_train_pred1))
print(accuracy_score(y_test, lgb_test_pred1))
--------------------------------------------------------------------------------------------------------------------------------
0.9538152610441767
0.7897196261682243
```

```python
# 1-2. ë‹¨ì¼ ëª¨ë¸ xgboost

xgb_model1 = XGBClassifier(random_state = 39)
xgb_model1.fit(X_train, y_train)

xgb_train_pred1 = xgb_model1.predict(X_train)
xgb_test_pred1 = xgb_model1.predict(X_test)

print(accuracy_score(y_train, xgb_train_pred1))
print(accuracy_score(y_test, xgb_test_pred1))
--------------------------------------------------------------------------------------------------------------------------------
0.9799196787148594
0.7990654205607477
```

```python
# 1-3. ë‹¨ì¼ ëª¨ë¸ catboost

cat_model1 = CatBoostClassifier(random_state = 39, verbose = False)
cat_model1.fit(X_train, y_train)

cat_train_pred1 = cat_model1.predict(X_train)
cat_test_pred1 = cat_model1.predict(X_test)

print(accuracy_score(y_train, cat_train_pred1))
print(accuracy_score(y_test, cat_test_pred1))
--------------------------------------------------------------------------------------------------------------------------------
0.9096385542168675
0.8037383177570093
```

```python
# 1-4. ë‹¨ì¼ ëª¨ë¸ extratree

etc_model1 = ExtraTreesClassifier(random_state = 39)
etc_model1.fit(X_train, y_train)

etc_train_pred1 = etc_model1.predict(X_train)
etc_test_pred1 = etc_model1.predict(X_test)

print(accuracy_score(y_train, etc_train_pred1))
print(accuracy_score(y_test, etc_test_pred1))
--------------------------------------------------------------------------------------------------------------------------------
0.9879518072289156
0.780373831775701
```

```python
# 1-5. ë‹¨ì¼ ëª¨ë¸ randomforest

rf_model1 = RandomForestClassifier(random_state = 39)
rf_model1.fit(X_train, y_train)

rf_train_pred1 = rf_model1.predict(X_train)
rf_test_pred1 = rf_model1.predict(X_test)

print(accuracy_score(y_train, rf_train_pred1))
print(accuracy_score(y_test, rf_test_pred1))
--------------------------------------------------------------------------------------------------------------------------------
0.9879518072289156
0.8084112149532711
```

ë‹¨ì¼ ëª¨ë¸ì— ëŒ€í•œ ì„±ëŠ¥ì„ ë³´ì•˜ì„ ë•Œ, 5ê°œ ëª¨ë¸ ëª¨ë‘ Train Dataì— ìƒë‹¹íˆ ê³¼ëŒ€ì í•©ëœ ê²½í–¥ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Test Dataì— ëŒ€í•´ ê°€ì¥ ì„±ëŠ¥ì´ ì¢‹ì€ ëª¨ë¸ì€ RandomForest êµ°ìš”!

| Model           | Accuracy Score(Train) | Accuracy Score(Test)            |
| --------------- | --------------------- | ------------------------------- |
| 1. LightGBM     | 95.38%                | 78.97%                          |
| 2. XgBoost      | 97.99%                | 79.91%                          |
| 3. CatBoost     | 90.96%                | 80.37%                          |
| 4. ExtraTrees   | 98.80%                | 78.04%                          |
| 5. RandomForest | 98.80%                | <font color="red">80.84%</font> |

<br>

### (2) CV ê¸°ë°˜ì˜ Stacking Ensemble

#### <b>STAGE 1</b>

------

ì°¸ê³ ë¡œ FoldëŠ” 7ë¡œ ë‘ì—ˆëŠ”ë° ê²½í—˜ìƒ ì´ì§„ë¶„ë¥˜ëª¨ë¸ì— í•œí•˜ì—¬ 5, 7ê³¼ ê°™ì€ í™€ìˆ˜ê°€ ì¢‹ì€ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì§ìˆ˜ê°€ ë˜ë©´ ë™ë¥ ì´ ë˜ì–´ ì˜ˆì¸¡ê°’ì´ ì• ë§¤í•´ì§€ëŠ” ê²½ìš°ê°€ ë§ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ë¥¼ í”¼í•˜ê¸° ìœ„í•´ ì´ì§„ë¶„ë¥˜ì—ì„œëŠ” Foldë¥¼ í™€ìˆ˜ë¡œ ë‘ê±°ë‚˜, ì•„ì˜ˆ predict_proba ê°’ìœ¼ë¡œ ê°€ì ¸ê°€ëŠ” ê²ƒì´ ì¢‹ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.

ë‹¤ì‹œ ëŒì•„ì™€ì„œ, ì´ˆëª¨ìˆ˜ ìµœì í™” ì‘ì—…ì€ ìƒëµí•˜ì˜€ê³  ì•„ë˜ì™€ ê°™ì´ ê° ëª¨ë¸ì— ëŒ€í•œ Train_pred, Test_pred ê°’ì„ êµ¬í•©ë‹ˆë‹¤.

```python
# 2-1. lightgbm stacking
n_fold = 7
cv = StratifiedKFold(n_splits = n_fold, shuffle = True, random_state = 39)

lgb_train = np.zeros((X_train.shape[0]))
lgb_test = np.zeros((X_test.shape[0]))

print(lgb_train.shape)

for i, (i_trn, i_val) in enumerate(cv.split(X_train, y_train), 1):
    print(f'training model for CV #{i}')
    lgb_model2 = LGBMClassifier(random_state = 39)

    lgb_model2.fit(X_train.loc[i_trn, :], y_train[i_trn])

    lgb_train[i_val] = lgb_model2.predict(X_train.loc[i_val, :])
    lgb_test += lgb_model2.predict(X_test) / n_fold
```

```python
# 2-2. xgboost stacking
n_fold = 7
cv = StratifiedKFold(n_splits = n_fold, shuffle = True, random_state = 39)

xgb_train = np.zeros((X_train.shape[0]))
xgb_test = np.zeros((X_test.shape[0]))

print(xgb_train.shape)

for i, (i_trn, i_val) in enumerate(cv.split(X_train, y_train), 1):
    print(f'training model for CV #{i}')
    xgb_model2 = XGBClassifier(random_state = 39)

    xgb_model2.fit(X_train.loc[i_trn, :], y_train[i_trn])

    xgb_train[i_val] = xgb_model2.predict(X_train.loc[i_val, :])
    xgb_test += xgb_model2.predict(X_test) / n_fold
```

```python
# 2-3. catboost stacking
n_fold = 7
cv = StratifiedKFold(n_splits = n_fold, shuffle = True, random_state = 39)

cat_train = np.zeros((X_train.shape[0]))
cat_test = np.zeros((X_test.shape[0]))

print(cat_train.shape)

for i, (i_trn, i_val) in enumerate(cv.split(X_train, y_train), 1):
    print(f'training model for CV #{i}')
    cat_model2 = CatBoostClassifier(random_state = 39, verbose = False)

    cat_model2.fit(X_train.loc[i_trn, :], y_train[i_trn])

    cat_train[i_val] = cat_model2.predict(X_train.loc[i_val, :])
    cat_test += cat_model2.predict(X_test) / n_fold
```

```python
# 2-4. extratrees stacking
n_fold = 7
cv = StratifiedKFold(n_splits = n_fold, shuffle = True, random_state = 39)

etc_train = np.zeros((X_train.shape[0]))
etc_test = np.zeros((X_test.shape[0]))

print(etc_train.shape)

for i, (i_trn, i_val) in enumerate(cv.split(X_train, y_train), 1):
    print(f'training model for CV #{i}')
    etc_model2 = ExtraTreesClassifier(random_state = 39, verbose = False)

    etc_model2.fit(X_train.loc[i_trn, :], y_train[i_trn])

    etc_train[i_val] = etc_model2.predict(X_train.loc[i_val, :])
    etc_test += etc_model2.predict(X_test) / n_fold
```

```python
# 2-5. randomforest stacking
n_fold = 7
cv = StratifiedKFold(n_splits = n_fold, shuffle = True, random_state = 39)

rf_train = np.zeros((X_train.shape[0]))
rf_test = np.zeros((X_test.shape[0]))

print(rf_train.shape)

for i, (i_trn, i_val) in enumerate(cv.split(X_train, y_train), 1):
    print(f'training model for CV #{i}')
    rf_model2 = RandomForestClassifier(random_state = 39, verbose = False)

    rf_model2.fit(X_train.loc[i_trn, :], y_train[i_trn])

    rf_train[i_val] = rf_model2.predict(X_train.loc[i_val, :])
    rf_test += rf_model2.predict(X_test) / n_fold
```

#### <b>STAGE 2</b>

------

ëª¨ë“  ëª¨ë¸ì— ëŒ€í•´ Train_pred1~5, Test_pred1~5ë¥¼ êµ¬í–ˆìœ¼ë©´ ì˜ˆì¸¡ê°’ì„ í•©ì³ í•˜ë‚˜ì˜ Stacking Data Setì„ ë§Œë“­ë‹ˆë‹¤.

```python
temp1 = pd.DataFrame(lgb_train.T, columns = ['lgb_pred'])
temp2 = pd.DataFrame(xgb_train.T, columns = ['xgb_pred'])
temp3 = pd.DataFrame(cat_train.T, columns = ['cat_pred'])
temp4 = pd.DataFrame(etc_train.T, columns = ['etc_pred'])
temp5 = pd.DataFrame(rf_train.T, columns = ['rf_pred'])

stk_train = pd.concat([temp1, temp2, temp3, temp4, temp5], axis = 1)
stk_train
```

<img src="/images/2024-04-14-AI3/image-20240414170636523.png" alt="image-20240414170636523" style="zoom:80%;" />

```python
temp1 = pd.DataFrame(lgb_test.T, columns = ['lgb_pred'])
temp2 = pd.DataFrame(xgb_test.T, columns = ['xgb_pred'])
temp3 = pd.DataFrame(cat_test.T, columns = ['cat_pred'])
temp4 = pd.DataFrame(etc_test.T, columns = ['etc_pred'])
temp5 = pd.DataFrame(rf_test.T, columns = ['rf_pred'])

stk_test = pd.concat([temp1, temp2, temp3, temp4, temp5], axis = 1)
stk_test
```

<img src="/images/2024-04-14-AI3/image-20240414170700489.png" alt="image-20240414170700489" style="zoom:80%;" />

Stacking Modelì€ Stage 1ì—ì„œ ê°€ì¥ ì„±ëŠ¥ì´ ì¢‹ì•˜ë˜ RandomForestë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê¼­ ê·¸ë ‡ë‹¤ê³  í•´ì„œ ë‹¤ë¥¸ ëª¨ë¸ì„ ì‚¬ìš©í•˜ì§€ ì•Šì•„ì•¼ ë˜ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. ì €ëŠ” í¸ì˜ìƒ RandomForestë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ë˜í•œ Stage 2ì—ì„œë„ êµì°¨ê²€ì¦ì„ ì´ìš©í–ˆìŠµë‹ˆë‹¤.

```python
# 2-6. stacking
n_fold = 7
cv = StratifiedKFold(n_splits = n_fold, shuffle = True, random_state = 39)

stk_train2 = np.zeros((stk_train.shape[0]))
stk_test2 = np.zeros((stk_test.shape[0]))

print(stk_train2.shape)

for i, (i_trn, i_val) in enumerate(cv.split(stk_train, y_train), 1):
    print(f'training model for CV #{i}')
    stk_model = RandomForestClassifier(random_state = 39, verbose = False)

    stk_model.fit(stk_train.loc[i_trn, :], y_train[i_trn])

    stk_train2[i_val] = stk_model.predict(stk_train.loc[i_val, :])
    stk_test2 += stk_model.predict(stk_test) / n_fold
```

```python
stk_train['final_pred'] = stk_train2
stk_train
```

<img src="/images/2024-04-14-AI3/image-20240414171106776.png" alt="image-20240414171106776" style="zoom:80%;" />

 stk_test2ì˜ ê²½ìš° í‰ê· ì¹˜ë¡œ ê³„ì‚°ëê¸° ë•Œë¬¸ì— ê¸°ì¤€ì¹˜ì¸ Thresholdë¥¼ 0.5ë¡œ ë‘ì–´ 0ê³¼ 1ë¡œ ë‹¤ì‹œ ë¶„ë¥˜ì‘ì—…ì„ ì§„í–‰í•©ë‹ˆë‹¤.

```python
stk_test['final_pred'] = 0

for i in range(stk_test.shape[0]) :
  if stk_test2[i] >= 0.5 :
    stk_test.loc[i, 'final_pred'] = 1

stk_test
```

<img src="/images/2024-04-14-AI3/image-20240414171131889.png" alt="image-20240414171131889" style="zoom:80%;" />

ê²°ê³¼ì ìœ¼ë¡œ Test Dataì— ëŒ€í•œ ì„±ëŠ¥ì€ 80.84%ê°€ ë‚˜ì™”ìŠµë‹ˆë‹¤. RandomForest ë‹¨ì¼ëª¨ë¸ê³¼ ë™ë¥ ë¡œ ê°€ì¥ ë†’ê²Œ ë‚˜ì™”ìœ¼ë©°, Train Dataì—ë„ ê³¼ëŒ€ì í•©ë˜ì§€ ì•Šì€ ì•ˆì •ì ì¸ ì„±ëŠ¥ì„ ë³´ì´ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
print(accuracy_score(y_train, stk_train['final_pred']))
print(accuracy_score(y_test, stk_test['final_pred']))
--------------------------------------------------------------------------------------------------------------------------------
0.8232931726907631
0.8084112149532711
```

| Model                       | Accuracy Score(Train) | Accuracy Score(Test)            |
| --------------------------- | --------------------- | ------------------------------- |
| 1. LightGBM                 | 95.38%                | 78.97%                          |
| 2. XgBoost                  | 97.99%                | 79.91%                          |
| 3. CatBoost                 | 90.96%                | 80.37%                          |
| 4. ExtraTrees               | 98.80%                | 78.04%                          |
| 5. RandomForest             | 98.80%                | <font color="red">80.84%</font> |
| <b>6. Stacking Ensemble</b> | 82.33%                | <font color="red">80.84%</font> |

<br>

### (3) Blending Ensemble

Blending Ensembleì˜ ê²½ìš°, Train Dataë¥¼ ë‹¤ì‹œ PartTrain Dataì™€ Validation Dataë¡œ ë‚˜ëˆ ì•¼ í•©ë‹ˆë‹¤.

```python
X_partrain, X_val, y_partrain, y_val = train_test_split(X_train, y_train, test_size = 0.3, random_state = 39, stratify = y_train)
print(X_train.shape, y_train.shape)
print(X_partrain.shape, y_partrain.shape)
print(X_val.shape, y_val.shape)
print(X_test.shape, y_test.shape)
--------------------------------------------------------------------------------------------------------------------------------
(498, 10) (498,)
(348, 10) (348,)
(150, 10) (150,)
(214, 10) (214,)
```

#### <b>STAGE 1</b>

------

ë§ˆì°¬ê°€ì§€ë¡œ ì´ˆëª¨ìˆ˜ ìµœì í™” ì‘ì—…ì€ ìƒëµí•˜ì˜€ê³  ê° ëª¨ë¸ì— ëŒ€í•´ Val_predì™€ Test_predë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.

```python
# 3-1. lightgbm blending
lgb_model = LGBMClassifier(random_state = 39)
lgb_model.fit(X_partrain, y_partrain)
lgb_val_pred = lgb_model.predict(X_val)
lgb_test_pred = lgb_model.predict(X_test)
```

```python
# 3-2. xgboost blending
xgb_model = XGBClassifier(random_state = 39)
xgb_model.fit(X_partrain, y_partrain)
xgb_val_pred = xgb_model.predict(X_val)
xgb_test_pred = xgb_model.predict(X_test)
```

```python
# 3-3. catboost blending
cat_model = CatBoostClassifier(random_state = 39, verbose = False)
cat_model.fit(X_partrain, y_partrain)
cat_val_pred = cat_model.predict(X_val)
cat_test_pred = cat_model.predict(X_test)
```

```python
# 3-4. extratrees blending
etc_model = ExtraTreesClassifier(random_state = 39)
etc_model.fit(X_partrain, y_partrain)
etc_val_pred = etc_model.predict(X_val)
etc_test_pred = etc_model.predict(X_test)
```

```python
# 3-5. randomforest blending
rf_model = RandomForestClassifier(random_state = 39)
rf_model.fit(X_partrain, y_partrain)
rf_val_pred = rf_model.predict(X_val)
rf_test_pred = rf_model.predict(X_test)
```

#### <b>STAGE 2</b>

------

ëª¨ë“  ëª¨ë¸ì— ëŒ€í•´ Train_pred1~5, Test_pred1~5ë¥¼ êµ¬í–ˆìœ¼ë©´ ì˜ˆì¸¡ê°’ì„ ê¸°ì¡´ ë°ì´í„°ì…‹ì¸ Validation Dataì™€ Test Dataì— ê°ê° ì¶”ê°€í•©ë‹ˆë‹¤.

```python
X_val.reset_index(inplace = True, drop = True)
X_test.reset_index(inplace = True, drop = True)

temp1 = pd.DataFrame(lgb_val_pred.T, columns = ['lgb_pred'])
temp2 = pd.DataFrame(xgb_val_pred.T, columns = ['xgb_pred'])
temp3 = pd.DataFrame(cat_val_pred.T, columns = ['cat_pred'])
temp4 = pd.DataFrame(etc_val_pred.T, columns = ['etc_pred'])
temp5 = pd.DataFrame(rf_val_pred.T, columns = ['rf_pred'])

bld_train = pd.concat([X_val, temp1, temp2, temp3, temp4, temp5], axis = 1)
bld_train
```

<img src="/images/2024-04-14-AI3/image-20240414172602335.png" alt="image-20240414172602335" style="zoom:80%;" />

```python
temp1 = pd.DataFrame(lgb_test_pred.T, columns = ['lgb_pred'])
temp2 = pd.DataFrame(xgb_test_pred.T, columns = ['xgb_pred'])
temp3 = pd.DataFrame(cat_test_pred.T, columns = ['cat_pred'])
temp4 = pd.DataFrame(etc_test_pred.T, columns = ['etc_pred'])
temp5 = pd.DataFrame(rf_test_pred.T, columns = ['rf_pred'])

bld_test = pd.concat([X_test, temp1, temp2, temp3, temp4, temp5], axis = 1)
bld_test
```

<img src="/images/2024-04-14-AI3/image-20240414172633132.png" alt="image-20240414172633132" style="zoom:80%;" />

Stacking Ensembleê³¼ ë§ˆì°¬ê°€ì§€ë¡œ Blending Ensembleë„ RandomForestë¥¼ ì´ìš©í–ˆìŠµë‹ˆë‹¤.

```python
rf_model2 = RandomForestClassifier(random_state = 39)
rf_model2.fit(bld_train, y_val)
rf_val_pred2 = rf_model2.predict(bld_train)
rf_test_pred2 = rf_model2.predict(bld_test)
```

```python
print(accuracy_score(y_val, rf_val_pred2))
print(accuracy_score(y_test, rf_test_pred2))
--------------------------------------------------------------------------------------------------------------------------------
1.0
0.7570093457943925
```

ê²°ê³¼ì ìœ¼ë¡œ, Blending Ensembleì€ 7ê°œì˜ ëª¨ë¸ ì¤‘ ê°€ì¥ í° ê³¼ëŒ€ì í•© ê²½í–¥ì„±ì„ ë³´ì´ë©°, ì„±ëŠ¥ë„ ê°€ì¥ ì¢‹ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì‚¬ì‹¤ ê°œì¸ì ìœ¼ë¡œ Blending Ensembleì€ ê¶Œí•´ë“œë¦¬ì§„ ì•ŠìŠµë‹ˆë‹¤. ë³´ì‹œë‹¤ì‹œí”¼ ê³¼ëŒ€ì í•©ì´ ë‚˜íƒ€ë‚  ê°€ëŠ¥ì„±ì´ ë§¤ìš° í¬ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë§Œì•½, ê³µëª¨ì „ì´ë‚˜ í”„ë¡œì íŠ¸ë¥¼ ìˆ˜í–‰í•œë‹¤ë©´ ë‹¤ì†Œ ì•Œê³ ë¦¬ì¦˜ì´ ë³µì¡í•˜ì§€ë§Œ ì„±ëŠ¥ì´ ì¡°ê¸ˆ ë” ì˜¬ë¼ê°ˆ ìˆ˜ ìˆëŠ” Stacking Ensembleì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.

|                             | Accuracy Score(Train) | Accuracy Score(Test)             |
| --------------------------- | --------------------- | -------------------------------- |
| 1. LightGBM                 | 95.38%                | 78.97%                           |
| 2. XgBoost                  | 97.99%                | 79.91%                           |
| 3. CatBoost                 | 90.96%                | 80.37%                           |
| 4. ExtraTrees               | 98.80%                | 78.04%                           |
| 5. RandomForest             | 98.80%                | <font color="red">80.84%</font>  |
| <b>6. Stacking Ensemble</b> | 82.33%                | <font color="red">80.84%</font>  |
| <b>7. Blending Ensemble</b> | 100.00%               | <font color="blue">75.70%</font> |

<br>

#### *Reference*

1. <mark style='background-color: #0550ae'><b><a href='https://medium.com/@stevenyu530_73989/stacking-and-blending-intuitive-explanation-of-advanced-ensemble-methods-46b295da413c'><font color="white">Medium</font></a></b></mark>
1. <mark style='background-color: #0550ae'><b><a href='https://3months.tistory.com/486'><font color="white">Deep Play</font></a></b></mark>
1. <mark style='background-color: #0550ae'><b><a href='https://lsjsj92.tistory.com/559'><font color="white">ê¿ˆ ë§ì€ ì‚¬ëŒì˜ ì´ì•¼ê¸°</font></a></b></mark>
1. <mark style='background-color: #0550ae'><b><a href='https://slowsteadystat.tistory.com/21'><font color="white">ì–´ì©Œë‹¤ í†µê³„</font></a></b></mark>

<br>

<img src="https://user-images.githubusercontent.com/37182279/216820587-4617a62e-0565-47f1-9ead-f4cd367572a1.png" alt="DATA_100%_LOGO_LIGHT" style="zoom:10%">{: .align-center}

<br>

<br>



