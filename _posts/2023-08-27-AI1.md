---
layout: single
title: "[Hyperparameter Optimization] Optuna"
categories: [AI]
tag: [Machine Learning, Deep Learning, AutoML, Optimization]
use_math: true
author_profile: false
typora-root-url: ../
---
-----
ì•ˆë…•í•˜ì„¸ìš”. ì›ë˜ëŠ” <mark style='background-color: #0550ae'><b><a href='https://woongsonvi.github.io/pytorch/TCH2/'><font color="white">ì§€ë‚œ í¬ìŠ¤íŠ¸</font></a></b></mark>ì— ì´ì–´ì„œ Pytorchì— ëŒ€í•´ í¬ìŠ¤íŒ…ì„ í•´ì•¼ ë˜ì§€ë§Œ, ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ëŠ” ì¡°ê¸ˆì€ íŠ¹ë³„í•˜ê²Œ ì œê°€ ê°€ì§€ê³  ìˆëŠ” AI ì§€ì‹ ì¤‘ í•˜ë‚˜ë¥¼ ê³µìœ ë“œë¦¬ë ¤ê³  í•©ë‹ˆë‹¤. ë¨¸ì‹ ëŸ¬ë‹ í˜¹ì€ ë”¥ëŸ¬ë‹ ëª¨ë¸ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ì´ˆëª¨ìˆ˜ë¼ê³  ë¶ˆë¦¬ëŠ” Hyperparameterë¥¼ ìµœì í™”í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤. ê·¸ íŠœë‹ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¤‘ í•˜ë‚˜ì¸ Optunaì— ëŒ€í•´ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤! ğŸ˜€ ~~ë‚´ìš©ì„ ì •ë¦¬í•˜ëŠë¼ê³  ì§€ë‚œ ì£¼ì— í¬ìŠ¤íŒ…ì„ ëª»í–ˆì—ˆë„¤ìš”.~~

## ì •ì˜

ë¨¸ì‹ ëŸ¬ë‹ í˜¹ì€ ë”¥ëŸ¬ë‹ ëª¨í˜•ì„ ìƒì„±í•  ë•Œ, ê°€ì¥ ìµœì ì˜ ì„±ëŠ¥ì„ ë‚¼ ìˆ˜ ìˆëŠ” ì´ˆëª¨ìˆ˜(Hyperparameter)ë¥¼ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤. ì´ˆëª¨ìˆ˜ë¥¼ ì°¾ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆìœ¼ë‚˜, ê·¸ ë™ì•ˆì€ ì£¼ë¡œ GridSearchCVë¥¼ ì´ìš©í•˜ì—¬ ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ë¥¼ íƒìƒ‰í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì¡°í•©ì˜ ìˆ˜ê°€ ì¼ì • ìˆ˜ì¤€ ì´ìƒìœ¼ë¡œ ë§ì•„ì§ˆ ê²½ìš°ì— ì‹œê°„ì´ ë§¤ìš° ì˜¤ë˜ ê±¸ë¦°ë‹¤ëŠ” ë‹¨ì ì´ ìˆì—ˆìŠµë‹ˆë‹¤. <u><b>Optuna</b></u> ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì´ˆëª¨ìˆ˜ íŠœë‹ì— ì‚¬ìš©ë˜ëŠ” AutoML ê¸°ë²•ìœ¼ë¡œ ì´ˆëª¨ìˆ˜ì˜ ë²”ìœ„ë¥¼ ì§ì ‘ ì§€ì •í•˜ì—¬ ìë™ìœ¼ë¡œ ìµœìƒì˜ ê²°ê³¼ë¥¼ ë‚´ëŠ” ì´ˆëª¨ìˆ˜ë¥¼ ì°¾ì•„ì¤ë‹ˆë‹¤. ê·¸ë¦¬ê³  íŒŒë¼ë¯¸í„° ê°„ì˜ ê´€ê³„ì™€ ëª¨ë¸ì´ ìµœì í™” ë˜ëŠ” Historyë¥¼ ì¢‹ì€ ì‹œê°í™”ë¥¼ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìµœì í™” ê¸°ë²•ì€ Optuna ì´ì™¸ì—ë„ ì•ì—ì„œ ì„¤ëª…í–ˆë˜ GridSearchCVì™€ Random Search, Bayesian Optimization ë“±ì´ ìˆìŠµë‹ˆë‹¤. ì´ì— ëŒ€í•´ì„œëŠ” ì¶”í›„ì— ì •ë¦¬í•˜ì—¬ ê°™ì´ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ê·¸ëŸ¼ ì‹¤ì œë¡œ ì˜ˆì‹œë¥¼ í†µí•´ í™•ì¸í•´ë³´ì£ !

## íŠ¹ì§•

ë¨¸ì‹ ëŸ¬ë‹ ê¸°ë²• ì¤‘ Boosting ê¸°ë²•ì¸ CatBoostë¥¼ ì´ìš©í•˜ì—¬ ë¶„ë¥˜ ëª¨ë¸ì„ ë§Œë“¤ë ¤ê³  í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ ë°ì´í„°ëŠ” Kaggleì—ì„œ êµ¬í•œ ë°ì´í„°ë¡œ \<Pima Indians Diabetes Database\> ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ìµœì†Œ 21ì„¸ ì´ìƒì˜ í”¼ë§ˆ ì¸ë””ì–¸ ì—¬ì„±ë“¤ì— ëŒ€í•œ ì˜ë£Œ ë°ì´í„°ë¡œ Y ë³€ìˆ˜ëŠ” ë‹¹ë‡¨ë³‘ ì§„ë‹¨ ì—¬ë¶€ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ë¶„ì„ì€ Colabì—ì„œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

ìš°ì„  Optunaì™€ CatboostëŠ” Colabì— ë‚´ì¥ë˜ì–´ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì•„ë‹ˆë¯€ë¡œ ë”°ë¡œ ì„¤ì¹˜ë¥¼ í•´ì•¼í•©ë‹ˆë‹¤. ì„¤ì¹˜ í›„ì— ì•„ë˜ì™€ ê°™ì´ importë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.

```python
!pip install optuna
!pip install catboost

from catboost import CatBoostClassifier
import optuna
from optuna import Trial
from optuna.samplers import TPESampler
import time
import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split, GridSearchCV
from sklearn.metrics import roc_auc_score
```

ê°„ë‹¨í•˜ê²Œ ì „ì²˜ë¦¬ í•œ ë°ì´í„°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ~~íŒŒì¼ ê²½ë¡œëŠ” ~ê¸°í˜¸ë¡œ ìƒëµí•©ë‹ˆë‹¤! ã…ã…~~

```python
pima = pd.read_csv('/~/diabetes.csv')
pima.columns = ['INDEX', 'Preg', 'Glu', 'Blood', 'Skin', 'Insul', 'BMI', 'Fam', 'Age', 'Outcome']

pima = pima.loc[(pima['Glu'] > 0) & (pima['Blood'] > 0) & (pima['Skin'] > 0) & (pima['Insul'] > 0) & (pima['BMI'] > 0), :]
pima = pima.drop('INDEX', axis = 1)
pima.reset_index(drop = True, inplace = True)

X = pima.drop('Outcome', axis = 1)
y = pima.loc[:, 'Outcome' : 'Outcome']
print(X.shape)
print(y.shape)
--------------------------------------------------------------------------------------------------------------------------------
(392, 8)
(392, 1)
```

![image-20230827184945547](/images/2023-08-26-AI1/image-20230827184945547.png){: .align-center}

ë°ì´í„°ë¥¼ train ë°ì´í„°ì™€ test ë°ì´í„°ë¡œ ë¶„í• í•©ë‹ˆë‹¤. ê²°ì¸¡ì¹˜ ê°’ í™•ì¸ì„ ìœ„í•´ info í•¨ìˆ˜ë¥¼ ì´ìš©í–ˆê³ , ëª¨ë‘ ê°’ì´ ì¡´ì¬í•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

```python
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.3, random_state = 39, stratify = y)
print(X_train.shape)
print(X_test.shape)
print(y_train.shape)
print(y_test.shape)
X_train.info()
--------------------------------------------------------------------------------------------------------------------------------
(274, 8)
(118, 8)
(274, 1)
(118, 1)
<class 'pandas.core.frame.DataFrame'>
Int64Index: 274 entries, 140 to 329
Data columns (total 8 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   Preg    274 non-null    int64  
 1   Glu     274 non-null    int64  
 2   Blood   274 non-null    int64  
 3   Skin    274 non-null    int64  
 4   Insul   274 non-null    int64  
 5   BMI     274 non-null    float64
 6   Fam     274 non-null    float64
 7   Age     274 non-null    int64  
dtypes: float64(2), int64(6)
memory usage: 19.3 KB
```

ê·¸ë¦¬ê³  Hyperparameter Optimizationì„ ìœ„í•´ train ë°ì´í„°ë¥¼ part train ë°ì´í„°ì™€ validation ë°ì´í„°ë¡œ ë‹¤ì‹œ ë¶„í• í•©ë‹ˆë‹¤.

```python
X_partrain, X_val, y_partrain, y_val = train_test_split(X_train, y_train, test_size = 0.3, random_state = 39, stratify = y_train)
print(X_partrain.shape)
print(X_val.shape)
print(y_partrain.shape)
print(y_val.shape)
--------------------------------------------------------------------------------------------------------------------------------
(191, 8)
(83, 8)
(191, 1)
(83, 1)
```

ì´ì œ Optuna ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•´ë´…ì‹œë‹¤! OptunaëŠ” ì´ˆëª¨ìˆ˜ì˜ ë²”ìœ„ë¥¼ ì‚¬ìš©ìê°€ ì§ì ‘ ì •í•  ìˆ˜ ìˆê³ , ê·¸ ì•ˆì—ì„œ ìµœì  ì„±ëŠ¥ì˜ ì´ˆëª¨ìˆ˜ë¥¼ ì°¾ì•„ì¤ë‹ˆë‹¤. ì•„ë˜ ê°ê°ì˜ í•¨ìˆ˜ë“¤ì€ ì–´ë–¤ í˜•íƒœì˜ ê°’ë“¤ì„ ë²”ìœ„ ë‚´ì—ì„œ Randomí•˜ê²Œ íƒìƒ‰í• ì§€ë¥¼ ì •í•´ì¤ë‹ˆë‹¤.

- <u><b>optuna.trial.Trial.suggest_categorical()</b></u> : <mark style='background-color: #7ff5a0'>List ë‚´</mark>ì—ì„œ ê°’ì„ ì„ íƒ
- <u><b>optuna.trial.Trial.suggest_int()</b></u> : ë²”ìœ„ ë‚´ì—ì„œ <mark style='background-color: #7ff5a0'>ì •ìˆ˜ê°’</mark>ì„ ì„ íƒ
- <u><b>optuna.trial.Trial.suggest_float()</b></u> : ë²”ìœ„ ë‚´ì—ì„œ <mark style='background-color: #7ff5a0'>ì‹¤ìˆ˜ê°’</mark>ì„ ì„ íƒ
- <u><b>optuna.trial.Trial.suggest_uniform()</b></u> : ë²”ìœ„ ë‚´ì—ì„œ <mark style='background-color: #7ff5a0'>ê· ì¼ë¶„í¬ ê°’</mark>ì„ ì„ íƒ
- <u><b>optuna.trial.Trial.suggest_discrete_uniform()</b></u> : ë²”ìœ„ ë‚´ì—ì„œ <mark style='background-color: #7ff5a0'>ì´ì‚° ê· ì¼ë¶„í¬ ê°’</mark>ì„ ì„ íƒ
- <u><b>optuna.trial.Trial.suggest_loguniform()</b></u> : ë²”ìœ„ ë‚´ì—ì„œ <mark style='background-color: #7ff5a0'>ë¡œê·¸í•¨ìˆ˜ ê°’</mark>ì„ ì„ íƒ

ìš°ì„  objective í•¨ìˆ˜ë¥¼ ë”°ë¡œ ìƒì„±í•  ê²ƒì´ê³ , ê·¸ ì•ˆì— ì´ˆëª¨ìˆ˜ íƒìƒ‰ ë²”ìœ„ë¥¼ ì •í•´ì¤ë‹ˆë‹¤. ì•„ë˜ì˜ ê²½ìš°ëŠ” í•™ìŠµë¥ ì€ ë¡œê·¸í•¨ìˆ˜ ê°’ì„, ì´ˆëª¨ìˆ˜ì—ì„œ ì¤‘ìš”í•œ ë¶€ë¶„ì„ ì°¨ì§€í•˜ê³  ìˆëŠ” n_estimatorsì™€ max_depthëŠ” ì •ìˆ˜ê°’ìœ¼ë¡œ íƒìƒ‰í•©ë‹ˆë‹¤. ê·¸ ë‹¤ìŒ CatBoost ë¶„ë¥˜ ëª¨ë¸ì„ ë§Œë“­ë‹ˆë‹¤. part train ë°ì´í„°ë¡œ í•™ìŠµí•˜ì—¬ validation ë°ì´í„° ê°’ì„ ë„£ì—ˆì„ ë•Œ, AUC ì ìˆ˜ê°€ ê°€ì¥ ì¢‹ì€ ì´ˆëª¨ìˆ˜ ê°’ì„ ì±„íƒí•˜ê³ , 100ë²ˆ ì´ìƒ ì´ˆëª¨ìˆ˜ê°€ ì—…ë°ì´íŠ¸ê°€ ì•ˆë  ì‹œ ì¢…ë£Œí•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ì•„ë˜ì™€ ê°™ì´ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

```python
def objective(trial : Trial) -> float :

    params_cat = {
        "random_state" : 39,
        'learning_rate' : trial.suggest_loguniform('learning_rate', 0.001, 0.1),
        "n_estimators" : trial.suggest_int("n_estimators", 100, 1000),
        "max_depth" : trial.suggest_int("max_depth", 3, 8)
  }

    model = CatBoostClassifier(**params_cat)
    model.fit(X_partrain, y_partrain, eval_set = [(X_val, y_val)],
              early_stopping_rounds = 100, verbose = False)

    cat_pred = model.predict(X_val)
    AUC = roc_auc_score(y_val, cat_pred)

    return AUC
```

Optunaê°€ ì–¼ë§ˆë‚˜ ë¹¨ë¦¬ ì´ˆëª¨ìˆ˜ ìµœì í™” ì‘ì—…ì„ í•´ì£¼ëŠ”ì§€ ì¸¡ì •í•˜ê¸° ìœ„í•´ <mark style='background-color: #f39393'>time</mark> ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•˜ì—¬ ì‹œê°„ì„ ì¸¡ì •í•´ë³´ê² ìŠµë‹ˆë‹¤. ì•„ë˜ ì½”ë“œì—ì„œ startì™€ endê°€ ê·¸ê²ƒì…ë‹ˆë‹¤. OptunaëŠ” ì•ì„œ ë§ì”€ë“œë ¸ë“¯ì´, ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ì— ëŒ€í•´ ì„±ëŠ¥ì„ ê³„ì‚°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¦‰, ì‚¬ìš©ìê°€ ì§€ì •í•œ ë²”ìœ„ ë‚´ì˜ ì´ˆëª¨ìˆ˜ë¥¼ Sampling í•˜ì—¬ ì„±ëŠ¥ì„ ë¹„êµí•©ë‹ˆë‹¤. ì¦‰, ë²”ìœ„ë¥¼ ì˜ ì§€ì •í•˜ëŠ” ê²ƒë„ ì¤‘ìš”í•˜ì§€ë§Œ, Samplingì„ ì–´ë–»ê²Œ í•˜ëŠëƒì— ë”°ë¼ ê²°ê³¼ë„ í¬ê²Œ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ì €ëŠ” <mark style='background-color: #7ff5a0'>TPESampler</mark>ë¥¼ ì´ìš©í–ˆìŠµë‹ˆë‹¤. ~~Samplerì— ëŒ€í•œ ë‚´ìš©ì€ ì €ë„ ì¶”ê°€ì ìœ¼ë¡œ ê³µë¶€í•œ ë’¤ì— í¬ìŠ¤íŒ…í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ê³µë¶€í•  ê²ƒë“¤ì´ ë§ë„¤ìš”... ğŸ¤£~~ ì„±ëŠ¥ ì§€í‘œê°€ AUC ì´ë¯€ë¡œ directionì„ "maximize"ë¡œ í•˜ì—¬ AUC ê°’ì´ í° ìª½ìœ¼ë¡œ ì´ˆëª¨ìˆ˜ë¥¼ ì„ íƒí•˜ë„ë¡ í–ˆê³ , ì´ 100ë²ˆì˜ ì‹œë®¬ë ˆì´ì…˜ì„ í–ˆìŠµë‹ˆë‹¤.

```python
start = time.time()

sampler = TPESampler(seed = 39)
study = optuna.create_study(
    study_name = "cat_parameter_opt",
    direction = "maximize",
    sampler = sampler)
study.optimize(objective, n_trials = 100)

end = time.time()
--------------------------------------------------------------------------------------------------------------------------------
[I 2023-08-20 09:46:02,765] A new study created in memory with name: cat_parameter_opt
[I 2023-08-20 09:46:04,004] Trial 0 finished with value: 0.6866883116883117 and parameters: {'learning_rate': 0.012410186619312995, 'n_estimators': 818, 'max_depth': 7}. Best is trial 0 with value: 0.6866883116883117.
[I 2023-08-20 09:46:05,846] Trial 1 finished with value: 0.6957792207792207 and parameters: {'learning_rate': 0.0017542833184007157, 'n_estimators': 642, 'max_depth': 6}. Best is trial 1 with value: 0.6957792207792207.
[I 2023-08-20 09:46:06,414] Trial 2 finished with value: 0.70487012987013 and parameters: {'learning_rate': 0.008468701231876565, 'n_estimators': 524, 'max_depth': 6}. Best is trial 2 with value: 0.70487012987013.
......
```

Optunaì˜ ìµœì í™” ì†Œìš”ì‹œê°„ì€ ì•½ 39.3ì´ˆë¡œ êµ‰ì¥íˆ ë¹¨ë¦¬ ë‚˜ì˜¨ ê²ƒì„ ë³¼ ìˆ˜ ìˆë„¤ìš”!

```python
print(f"{end - start:.5f} sec")
--------------------------------------------------------------------------------------------------------------------------------
39.27664 sec
```

ì•„ë˜ ì½”ë“œì™€ ê°™ì´ ê°€ì¥ ì¢‹ì€ ì„±ëŠ¥ì˜ ëª¨ë¸ì¼ ë•Œì˜ ì´ˆëª¨ìˆ˜ë¥¼ ë„ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„±ëŠ¥ì€ AUC 71.4%ê°€ ë‚˜ì™”ê³ , í•™ìŠµë¥  0.002, ë‚˜ë¬´ ê°œìˆ˜ 574ê°œ, ê°€ì§€ ê¹Šì´ 4ì¼ ë•Œì˜ ëª¨ë¸ì´ ê°€ì¥ ì¢‹ì•˜ë‹¤ê³  ë§í•´ì£¼ê³  ìˆë„¤ìš”.

```python
print("Best Score :", study.best_value)
print("Best trial :", study.best_trial.params)
--------------------------------------------------------------------------------------------------------------------------------
Best Score : 0.713961038961039
Best trial : {'learning_rate': 0.002062014141105374, 'n_estimators': 574, 'max_depth': 4}
```

Optunaì— ë‚´ì¥ë˜ì–´ ìˆëŠ” ì‹œê°í™” í•¨ìˆ˜ë„ í•œë²ˆ ì•Œì•„ë´…ì‹œë‹¤! <mark style='background-color: #7ff5a0'>plot_optimization_history</mark>ë¥¼ ì´ìš©í•˜ë©´ ìµœì í™”ê°€ ì–´ë–»ê²Œ ì´ë£¨ì–´ì¡ŒëŠ”ì§€ ê¸°ë¡ì´ ì‹œê°í™”ë˜ì–´ ë„ì¶œë©ë‹ˆë‹¤. ê²°ê³¼ë¡œ ë³´ì•˜ì„ ë•, Trial 3ì¼ ë•Œê°€ ê°€ì¥ ì¢‹ì€ ê²ƒìœ¼ë¡œ ë³´ì˜€ëŠ”ë° ì œê°€ ë³´ì—¬ë“œë¦¬ì§€ëŠ” ì•Šì•˜ì§€ë§Œ [Best is trial 9 with value] ê²°ê³¼ê°€ ë„ì¶œëœ ê²ƒìœ¼ë¡œ ë´ì„œëŠ” Trial 9ê°€ ê°€ì¥ ì¢‹ì•˜ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë„¤ìš”! ì•„ë˜ì˜ ê·¸ë¦¼ì„ ë³´ì•˜ì„ ë•Œ, ë¹¨ê°„ ì¤„ì— Objective Value ê°’ì´ í›„ë°˜ë¶€ì—ë„ ë‹¤ì†Œ ë¶„í¬í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì €ë¼ë©´ 100ë³´ë‹¤ ë” í° Trial ìˆ˜ë¥¼ ì§€ì •í•˜ì—¬ í•œë²ˆ ë” ìµœì í™”ë¥¼ ì§„í–‰í•´ë³¼ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì´ë ‡ë“¯ ì ì ˆí•œ Trial ê°œìˆ˜ë¥¼ ì‹œê°í™”ë¥¼ í†µí•´ ì •í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
optuna.visualization.plot_optimization_history(study)
```

![Optuna 1](/images/2023-08-26-AI1/Optuna 1.png){: .align-center}

ë‹¤ìŒìœ¼ë¡œ <mark style='background-color: #7ff5a0'>plot_parallel_coordinates</mark>ì…ë‹ˆë‹¤. íŒŒë¼ë¯¸í„° ê°„ì˜ ê´€ê³„ë¥¼ í™•ì¸í•  ë•Œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë©ë‹ˆë‹¤. ì•„ë˜ ê²°ê³¼ë¥¼ ë³´ë‹¤ì‹œí”¼ ê° ë³€ìˆ˜ë‹¹ 100ê°œì˜ ì ë“¤ì´ ë¶€ë¶„ë§ˆë‹¤ ì°í˜€ìˆê³ , ì´ë¥¼ ì§ì„ ìœ¼ë¡œ ì—°ê²°í•œ ê·¸ë˜í”„ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ max_depthì˜ ìˆ˜ê°€ ì ì„ìˆ˜ë¡ n_estimatorsëŠ” ì»¤ì§€ë ¤ í•˜ëŠ” ê²½í–¥ì„±ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ~~ê°€ì§€ ìˆ˜ê°€ ì ì–´ì§€ë‹ˆ ë‚˜ë¬´ ìˆ˜ê°€ ì¦ê°€í•´ì•¼ í•¨ì€ ì–´ë–»ê²Œ ë³´ë©´ ë‹¹ì—°í•˜ê²Œ ìƒê°ë©ë‹ˆë‹¤.~~ ì €ì˜ ê²½ìš° ì´ˆëª¨ìˆ˜ íƒìƒ‰ ë²”ìœ„ë¥¼ ì§€ì •í•  ë•Œë„ ì´ ê²°ê³¼ë¥¼ ë§ì´ ì°¸ê³ í•©ë‹ˆë‹¤. ë§Œì•½ max_depthê°€ 3ì´ ì•„ë‹Œ 8ì— í›¨ì”¬ ì ë“¤ì´ ë§ì´ ì°í˜€ìˆê³ , ì§ì„ ë„ ë§ì´ ì—°ê²°ë˜ì–´ ìˆë‹¤ë©´ ë²”ìœ„ë¥¼ [3, 8]ì´ ì•„ë‹Œ [3, 10] ì •ë„ë¡œ ëŠ˜ë ¤ë³´ëŠ” í¸ì…ë‹ˆë‹¤.

```python
optuna.visualization.plot_parallel_coordinate(study)
```

![Optuna 2](/images/2023-08-26-AI1/Optuna 2.png){: .align-center}

<mark style='background-color: #7ff5a0'>plot_param_importances</mark>ëŠ” ì´ˆëª¨ìˆ˜ì˜ ì¤‘ìš”ë„ë¥¼ ì‹œê°í™” í•´ì£¼ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. ì´ ë°ì´í„°ì—ì„œëŠ” í•™ìŠµë¥ ì´ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤ê³  í•˜ëŠ” êµ°ìš”! ì´ì „ì— plot_parallel_coordinates ê²°ê³¼ë¥¼ ë³´ë©´ í•™ìŠµë¥ ì˜ ì ë“¤ì´ ë‹¤ë¥¸ ì´ˆëª¨ìˆ˜ë³´ë‹¤ ë„“ê²Œ ë¶„í¬í•˜ê³  ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ë‹¤ì‹œ ìƒê°í•´ë³´ë©´, ë‹¤ë¥¸ ì´ˆëª¨ìˆ˜ë³´ë‹¤ í•™ìŠµë¥  ê°’ì„ ì˜ ì¡°ì •í•´ì£¼ê³  ì‹ ê²½ì„ ì¨ì¤˜ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

```python
optuna.visualization.plot_param_importances(study)
```

![Optuna 3](/images/2023-08-26-AI1/Optuna 3.png){: .align-center}ë§ˆì§€ë§‰ìœ¼ë¡œ <mark style='background-color: #7ff5a0'>plot_slice</mark>ì…ë‹ˆë‹¤. ê° ì´ˆëª¨ìˆ˜ì— ëŒ€í•˜ì—¬ ê°œë³„ì ì¸ ìµœì ì˜ ë¶€ë¶„ ê³µê°„ì´ ì–´ë””ì— ìœ„ì¹˜í•˜ëŠ”ì§€ ì´í•´í•˜ëŠ” ë° ë„ì›€ì„ ì¤€ë‹¤ê³  í•©ë‹ˆë‹¤. ê°œì¸ì ìœ¼ë¡œ í¬ê²Œ ì‚¬ìš©í•˜ëŠ” ì‹œê°í™”ëŠ” ì•„ë‹™ë‹ˆë‹¤.

```python
optuna.visualization.plot_slice(study)
```

![Optuna 4](/images/2023-08-26-AI1/Optuna 4.png){: .align-center}

ì ê·¸ëŸ¼ ì´ì œ í•œë²ˆ ë¹„êµë¥¼ í•´ë´…ì‹œë‹¤! ì•„ë˜ëŠ” GridSearchCVë¥¼ í†µí•´ ì´ˆëª¨ìˆ˜ ìµœì í™”ë¥¼ í•œ ê²°ê³¼ì…ë‹ˆë‹¤. GridSearchCVëŠ” ì‚¬ìš©ìê°€ ì´ˆëª¨ìˆ˜ì˜ ë²”ìœ„ê°€ ì•„ë‹Œ ì´ˆëª¨ìˆ˜ ê°ê°ì˜ ì›í•˜ëŠ” ê°’ì„ ì§€ì •í•˜ë©´, ê·¸ì— ëŒ€í•œ ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ë¥¼ ê³„ì‚°í•˜ì—¬ ìµœì ì˜ ì´ˆëª¨ìˆ˜ë¥¼ ë„ì¶œí•©ë‹ˆë‹¤. ì•„ë˜ì˜ ê²½ìš°ì˜ ìˆ˜ë¥¼ ëª¨ë‘ ê³„ì‚°í•œë‹¤ë©´ $5 \times 5 \times 5 = 125$ê°€ ë©ë‹ˆë‹¤. 3ê°œì˜ ì´ˆëª¨ìˆ˜ì— ëŒ€í•´ ê°ê° 5ê°œì˜ ê°’ë§Œ ì‚¬ìš©ìê°€ ì§€ì •ì„ í–ˆìœ¼ë¯€ë¡œ, ë­”ê°€? ë²”ìœ„ë¡œ ì§€ì •ì„ í•œ Optuna ë³´ë‹¤ëŠ” í›¨ì”¬ ë¹ ë¥¸ ì‹œê°„ ë‚´ì— ê²°ê³¼ê°€ ë„ì¶œë  ê²ƒ ê°™ìŠµë‹ˆë‹¤!

```python
start = time.time()

param_grid = [{
               'learning_rate' : [0.02, 0.04, 0.06, 0.08, 0.1],
               "n_estimators" : [100, 200, 300, 400, 500],
               "max_depth" : [3, 4, 5, 6, 7]}]
gs = GridSearchCV(estimator = CatBoostClassifier(random_state = 39, verbose = False), param_grid = param_grid, scoring = 'roc_auc')
model = gs.fit(X_partrain, y_partrain)
print(model.best_score_)
print(model.best_params_)

end = time.time()
--------------------------------------------------------------------------------------------------------------------------------
0.8393826429980276
{'learning_rate': 0.02, 'max_depth': 3, 'n_estimators': 400}
```

í•˜ì§€ë§Œ ì‹œê°„ì€ 219ì´ˆë¡œ 39ì´ˆì˜ Optunaë³´ë‹¤ ì†Œìš”ì‹œê°„ì´ í›¨ì”¬ ê±¸ë¦°ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²Œë‹¤ê°€ OptunaëŠ” GridSearchCVì™€ ë‹¬ë¦¬ ë²”ìœ„ ë‚´ì˜ Sampling ëœ ê°’ë“¤ì— ëŒ€í•´ ì´ˆëª¨ìˆ˜ ìµœì í™”ë¥¼ í•´ì£¼ë¯€ë¡œ ë³´ë‹¤ ì •í™•í•œ ì´ˆëª¨ìˆ˜ ê°’ì„ ê³„ì‚°í•´ì¤ë‹ˆë‹¤.

```python
print(f"{end - start:.5f} sec")
--------------------------------------------------------------------------------------------------------------------------------
219.06270 sec
```

<br>

#### *Reference*

1. <mark style='background-color: #0550ae'><b><a href='https://velog.io/@ttogle918/optuna-%EC%82%AC%EC%9A%A9%EB%B2%95'><font color="white">Hyun</font></a></b></mark>
1. <mark style='background-color: #0550ae'><b><a href='https://hojjimin-statistic.tistory.com/27'><font color="white">í†µê³„í•™ë„ì˜ ë°ì´í„° ë¶„ì„ ì„¸ìƒ</font></a></b></mark>
1. <mark style='background-color: #0550ae'><b><a href='https://dacon.io/codeshare/2704'><font color="white">Dacon_dswook</font></a></b></mark>
1. <mark style='background-color: #0550ae'><b><a href='https://dacon.io/codeshare/4646?dtype=recent'><font color="white">Dacon_yoonj</font></a></b></mark>
1. <mark style='background-color: #0550ae'><b><a href='https://jhtobigs.oopy.io/optuna_tutorial'><font color="white">ê¹€ ì£¼í˜¸</font></a></b></mark>

<br>

<img src="https://user-images.githubusercontent.com/37182279/216820587-4617a62e-0565-47f1-9ead-f4cd367572a1.png" alt="DATA_100%_LOGO_LIGHT" style="zoom:10%">{: .align-center}

<br>

<br>



